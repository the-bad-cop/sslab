<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>

<body>
	<pre>
/*
PASS 1 OF TWO PASS ASSEMBLER

#include< stdio.h>
#include < stdlib.h>
#include < string.h>
void main(){
FILE *in,*op,*sym,*inter;
char label[20],opcode[20],unwant[20],operandstr[20],aux[20];
int locc=0,start,operand,len=0,f;
in=fopen("input.txt","r");
sym=fopen("symtab.txt","w+");
inter=fopen("intermediate.txt","w");
op=fopen("optab.txt","r");
fscanf(in,"%s %s %s",label,opcode,operandstr);
if(strcmp(opcode,"START")==0){
start=atoi(operandstr);
locc=start;
fprintf(inter,"%d\t%s\t%s\t%s\n",locc,label,opcode,operandstr);
fscanf(in,"%s %s %s",label,opcode,operandstr);
}else{
locc=0;
}
while(strcmp(opcode,"END")!=0){
f=1;
fseek(sym, 0, SEEK_SET);
if(strcmp(label,"-")!=0){
while(!feof(sym)){
fscanf(sym,"%s %s",aux,unwant);
if(strcmp(aux,label)==0){
printf("Error");
f=0;
break;
}
}
fseek(sym, 0, SEEK_END);
if(f==1){
fprintf(sym,"%s\t%d\n",label,locc);
}
}
f=0;
fseek(op, 0, SEEK_SET);
while(!feof(op)){
fscanf(op,"%s %s",aux,unwant);
if(strcmp(aux,opcode)==0){\
fprintf(inter,"%d\t%s\t%s\t%s\n",locc,label,opcode,operandstr);
locc=locc+3;
f=1;
break;
}
}
if(f==0){
if(strcmp(opcode,"WORD")==0){
fprintf(inter,"%d\t%s\t%s\t%s\n",locc,label,opcode,operandstr);
locc=locc+3;
}
else if(strcmp(opcode,"RESW")==0){
fprintf(inter,"%d\t%s\t%s\t%s\n",locc,label,opcode,operandstr);
locc=locc+3*(atoi(operandstr));
}
else if(strcmp(opcode,"RESB")==0){
fprintf(inter,"%d\t%s\t%s\t%s\n",locc,label,opcode,operandstr);
locc=locc+(atoi(operandstr));
}
else if(strcmp(opcode,"BYTE")==0){
//printf("75 %d\t%s\n",locc,opcode);
if(operandstr[0]=='X'){
fprintf(inter,"%d\t%s\t%s\t%s\
n",locc,label,opcode,operandstr);
locc=locc+1;
}
 else
 {
 fprintf(inter,"%d\t%s\t%s\t%s\
n",locc,label,opcode,operandstr);
 len=strlen(operandstr)-2;
 locc=locc+len;
}
}
else{
printf("Error 85");
}
}
fscanf(in,"%s %s %s",label,opcode,operandstr);
}
fprintf(inter,"%d\t%s\t%s\t%d\n",locc,"-",opcode,start);
}


PASS 2 OF TWO PASS ASSEMBLER

#include< stdio.h>
#include < stdlib.h>
#include < string.h>
void main(){
 FILE *op,*sym,*inter,*object,*assm;
char label[20],opcode[20],unwant[20],operandstr[20],aux[20],addr[20],ope[10];
int lo=0,start=0,operand,add,pc,opadd,fop,fsym,len=0,f,qw=0,i=0;
inter=fopen("intermediate.txt","r");
sym=fopen("symtab.txt","r");
object=fopen("object.txt","w");
op=fopen("optab.txt","r");
 assm=fopen("assemble.txt","w");
 fscanf(inter,"%s %s %s %s",addr,label,opcode,operandstr);
 if(strcmp(opcode,"START")==0){
 start=atoi(operandstr);
 fprintf(assm,"%s %s %s %s\n",addr,label,opcode,operandstr);
 fprintf(object,"H^%d^%s\n",start,"25");
 fscanf(inter,"%s %s %s %s",addr,label,opcode,operandstr);
 }else{
 printf("Error22");
 }
 fprintf(object,"T^%d^%d^",start,len);
 while(strcmp(opcode,"END")!=0){
 fseek(op, 0, SEEK_SET);
 fop=0;
 while(!feof(op)){
 fscanf(op,"%s %s",aux,unwant);
if(strcmp(aux,opcode)==0){
 strcpy(ope,unwant);
 fop=1;
 fsym=0;
 fseek(sym, 0, SEEK_SET);
 if(strcmp(operandstr,"-")!=0){
 while(!feof(sym)){
 fscanf(sym,"%s %s",aux,unwant);
 if(strcmp(aux,operandstr)==0){
 opadd=atoi(unwant);
 fsym=1;
 break;
 }
 }if(fsym==0){
 printf("Error44");
 opadd=0;
 }
 }
 if(fsym){
 fprintf(object,"%s%d^",ope,opadd);
 fprintf(assm,"%s\t%s\t%s\t%s\t%s%d\n",addr,label,opcode,operandstr,ope,opadd);
 }
 }
 }
 if(fop==0){
 if((strcmp("BYTE",opcode)==0) || (strcmp("WORD",opcode)==0) ){
 if(strcmp(opcode,"WORD")==0){
 fprintf(object,"0000%s^",operandstr);
 fprintf(assm,"%s\t%s\t%s\t%s\t0000%s\n",addr,label,opcode,operandstr,operandstr);
 }
 else
 {
 fprintf(assm,"%s\t%s\t%s\t%s\t",addr,label,opcode,operandstr);
 len=strlen(operandstr);
 for(i=2;i< len;i++)
 {
 fprintf(object,"%d",operandstr[i]);
 fprintf(assm,"%d",operandstr[i]);
 }
 fprintf(object,"^");
 fprintf(assm,"\n");
 }
 }else{
 fprintf(assm,"%s\t%s\t%s\t%s\n",addr,label,opcode,operandstr);
 }
 } fscanf(inter,"%s %s %s %s",addr,label,opcode,operandstr);
 }
 fprintf(object,"\nE^%d\n",start);
}
*/
    </pre>
</body>

</html>